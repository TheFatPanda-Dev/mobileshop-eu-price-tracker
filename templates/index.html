<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Price Tracker</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Price Tracker</h1>
    <div class="mb-1-5em">
        <form id="add-track-form" method="post" action="/add_track" class="track-form">
            <input type="url" name="link" id="track-link" placeholder="Enter product link" required class="track-link-input">
            <input type="text" name="label" id="track-label" placeholder="Label" required class="track-label-input">
            <button type="submit" class="track-btn">Add to Tracking List</button>
        </form>
    </div>
    <div class="mb-1-5em">
        <label for="label-dropdown"><b>Show tracked items for label:</b></label>
        <select id="label-dropdown" name="label" onchange="showTrackedForLabel()" class="label-dropdown">
            <option value="">-- Select label --</option>
            {% for label in labels %}
                <option value="{{ label }}" {% if label == selected_label %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
                <form id="delete-label-form" method="post" action="/delete_label" style="display:inline;">
                                    <input type="hidden" name="label" id="delete-label-input">
                                    <button type="submit" id="delete-label-btn" class="delete-label-btn" title="Delete this tracker from dropdown">
                                            <span class="delete-btn-content">
                                                <svg class="delete-btn-x" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <circle cx="10" cy="10" r="9" stroke="#d32f2f" stroke-width="2" fill="#fff"/>
                                                    <line x1="6" y1="6" x2="14" y2="14" stroke="#d32f2f" stroke-width="2" stroke-linecap="round"/>
                                                    <line x1="14" y1="6" x2="6" y2="14" stroke="#d32f2f" stroke-width="2" stroke-linecap="round"/>
                                                </svg>
                                                <span class="delete-btn-text">Delete from tracking</span>
                                            </span>
                                    </button>
                </form>
    </div>
    <div id="tracked-items">
        {% if tracked_items %}
            <table>
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th class="price-col">Min Price</th>
                    <th class="price-col">Current Price</th>
                    <th class="price-col">Max Price</th>
                </tr>
                {% for product in tracked_items %}
                <tr {% if product.product_url %} onclick="window.open('{{ product.product_url }}', '_blank')" class="clickable-row" {% endif %}>
                    <td class="image-cell">
                        {% if product.image_url %}
                            <img src="{{ product.image_url }}" alt="Product Image" class="product-img">
                        {% else %}
                            No image
                        {% endif %}
                    </td>
                    <td>{{ product.name }}</td>
                    <td class="price-col min-price">{% if product.min_price %}{{ product.min_price }}{% else %}-{% endif %}</td>
                    <td class="price-col">{{ product.price }}</td>
                    <td class="price-col max-price">{% if product.max_price %}{{ product.max_price }}{% else %}-{% endif %}</td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>No tracked items for this label.</p>
        {% endif %}
    </div>
    <script>
        function showTrackedForLabel() {
            const label = document.getElementById('label-dropdown').value;
            window.location.href = '/?label=' + encodeURIComponent(label);
            document.getElementById('delete-label-input').value = label;
        }
        // Set delete input on page load and dropdown change
        document.addEventListener('DOMContentLoaded', function() {
            const dropdown = document.getElementById('label-dropdown');
            const delInput = document.getElementById('delete-label-input');
            delInput.value = dropdown.value;
            dropdown.addEventListener('change', function() {
                delInput.value = dropdown.value;
            });
        });
    </script>
</body>
</html>
